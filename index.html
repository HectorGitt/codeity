<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>CodeSec Scanner - Security Vulnerability Scanner</title>
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
			rel="stylesheet"
		/>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Inter", -apple-system, BlinkMacSystemFont,
					"Segoe UI", Roboto, sans-serif;
				background: linear-gradient(
					135deg,
					#e8f4fd 0%,
					#f0e6ff 25%,
					#fdf2f8 50%,
					#f0fdf4 75%,
					#fefce8 100%
				);
				background-size: 400% 400%;
				animation: gradientShift 15s ease infinite;
				color: #1f2937;
				min-height: 100vh;
				overflow-x: hidden;
			}

			@keyframes gradientShift {
				0% {
					background-position: 0% 50%;
				}
				50% {
					background-position: 100% 50%;
				}
				100% {
					background-position: 0% 50%;
				}
			}

			.background-decoration {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				pointer-events: none;
				z-index: 0;
			}

			.floating-shapes {
				position: absolute;
				width: 100%;
				height: 100%;
			}

			.shape {
				position: absolute;
				border-radius: 50%;
				background: rgba(255, 255, 255, 0.1);
				animation: float 20s infinite linear;
			}

			.shape:nth-child(1) {
				width: 80px;
				height: 80px;
				top: 10%;
				left: 10%;
				animation-delay: 0s;
			}

			.shape:nth-child(2) {
				width: 120px;
				height: 120px;
				top: 70%;
				left: 80%;
				animation-delay: 5s;
			}

			.shape:nth-child(3) {
				width: 60px;
				height: 60px;
				top: 30%;
				left: 70%;
				animation-delay: 10s;
			}

			.shape:nth-child(4) {
				width: 100px;
				height: 100px;
				top: 80%;
				left: 20%;
				animation-delay: 15s;
			}

			@keyframes float {
				0%,
				100% {
					transform: translateY(0px) rotate(0deg);
				}
				50% {
					transform: translateY(-20px) rotate(180deg);
				}
			}

			.container {
				max-width: 1400px;
				margin: 0 auto;
				padding: 20px;
				position: relative;
				z-index: 1;
			}

			.header {
				text-align: center;
				color: white;
				margin-bottom: 50px;
				padding: 40px 20px;
				background: rgba(255, 255, 255, 0.1);
				backdrop-filter: blur(20px);
				border-radius: 25px;
				border: 1px solid rgba(255, 255, 255, 0.2);
				box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
			}

			.header h1 {
				font-size: 3.5em;
				font-weight: 700;
				margin-bottom: 15px;
				text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.1);
				background: linear-gradient(45deg, #3b82f6, #8b5cf6);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				background-clip: text;
			}

			.header p {
				font-size: 1.3em;
				opacity: 0.95;
				font-weight: 400;
				letter-spacing: 0.5px;
			}

			.main-content {
				background: rgba(255, 255, 255, 0.95);
				backdrop-filter: blur(20px);
				border-radius: 25px;
				padding: 50px;
				box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
				border: 1px solid rgba(255, 255, 255, 0.3);
			}

			.scan-options {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
				gap: 30px;
				margin-bottom: 40px;
			}

			.option-card {
				background: linear-gradient(145deg, #fefefe, #f9fafb);
				border: 2px solid transparent;
				border-radius: 20px;
				padding: 35px;
				transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
				position: relative;
				overflow: visible;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
			}

			.option-card::before {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				border-radius: 20px;
				padding: 2px;
				background: linear-gradient(145deg, #a5b4fc, #c4b5fd, #fbbf24);
				-webkit-mask: linear-gradient(#fff 0 0) content-box,
					linear-gradient(#fff 0 0);
				-webkit-mask-composite: xor;
				mask: linear-gradient(#fff 0 0) content-box,
					linear-gradient(#fff 0 0);
				mask-composite: exclude;
				opacity: 0;
				transition: opacity 0.4s ease;
			}

			.option-card:hover::before {
				opacity: 1;
			}

			.option-card:hover {
				transform: translateY(-10px) scale(1.02);
				box-shadow: 0 30px 60px rgba(139, 92, 246, 0.15);
			}

			.option-card h3 {
				color: #6366f1;
				margin-bottom: 20px;
				font-size: 1.6em;
				font-weight: 600;
				display: flex;
				align-items: center;
				gap: 10px;
			}

			.form-group {
				margin-bottom: 25px;
			}

			.form-group label {
				display: block;
				margin-bottom: 8px;
				font-weight: 500;
				color: #374151;
				font-size: 0.95em;
				pointer-events: none;
				user-select: none;
			}

			.form-control {
				width: 100%;
				padding: 15px 18px;
				border: 2px solid #e5e7eb;
				border-radius: 12px;
				font-size: 16px;
				transition: all 0.3s ease;
				background: #ffffff;
				font-family: inherit;
				position: relative;
				z-index: 10;
				pointer-events: auto;
			}

			.form-control:focus {
				border-color: #a5b4fc;
				outline: none;
				box-shadow: 0 0 0 3px rgba(165, 180, 252, 0.2);
				transform: translateY(-2px);
			}

			select.form-control {
				cursor: pointer;
				appearance: auto;
				-webkit-appearance: menulist;
				-moz-appearance: menulist;
			}

			input[type="file"].form-control {
				cursor: pointer;
				padding: 12px 15px;
				line-height: 1.5;
			}

			input[type="file"].form-control::-webkit-file-upload-button {
				cursor: pointer;
				background: linear-gradient(135deg, #a5b4fc, #c4b5fd);
				color: white;
				border: none;
				padding: 8px 16px;
				border-radius: 8px;
				font-weight: 500;
				margin-right: 12px;
			}

			input[type="url"].form-control {
				cursor: text;
			}

			textarea.form-control {
				resize: vertical;
				min-height: 120px;
				font-family: "JetBrains Mono", "Fira Code", "Courier New",
					monospace;
				font-size: 14px;
				line-height: 1.5;
			}

			.checkbox-group {
				display: flex;
				flex-wrap: wrap;
				gap: 20px;
			}

			.checkbox-item {
				display: flex;
				align-items: center;
				background: #fcfcfd;
				padding: 12px 16px;
				border-radius: 10px;
				transition: all 0.3s ease;
				cursor: pointer;
				user-select: none;
				border: 2px solid transparent;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);
			}

			.checkbox-item:hover {
				background: #f8fafb;
				transform: translateY(-2px);
				border-color: #a5b4fc;
				box-shadow: 0 4px 12px rgba(165, 180, 252, 0.15);
			}

			.checkbox-item:active {
				transform: translateY(0);
			}

			.checkbox-item input[type="checkbox"] {
				margin-right: 10px;
				width: 18px;
				height: 18px;
				accent-color: #a5b4fc;
				cursor: pointer;
				position: relative;
			}

			.checkbox-item label {
				margin: 0;
				cursor: pointer;
				font-weight: 500;
				color: #374151;
				flex: 1;
			}

			.checkbox-item input[type="checkbox"]:disabled ~ label,
			.checkbox-item input[type="checkbox"]:disabled + label {
				color: #9ca3af;
				opacity: 0.6;
			}

			.checkbox-item input[type="checkbox"]:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			.checkbox-item:has(input[type="checkbox"]:disabled) {
				background: #f3f4f6;
				cursor: not-allowed;
				opacity: 0.7;
			}

			.checkbox-item:has(input[type="checkbox"]:disabled):hover {
				transform: none;
				border-color: transparent;
				box-shadow: none;
			}

			.btn {
				background: linear-gradient(135deg, #a5b4fc 0%, #c4b5fd 100%);
				color: white;
				border: none;
				padding: 18px 35px;
				border-radius: 12px;
				font-size: 16px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
				width: 100%;
				box-shadow: 0 10px 25px rgba(165, 180, 252, 0.4);
				position: relative;
				overflow: hidden;
				text-decoration: none;
				display: inline-block;
				text-align: center;
				user-select: none;
			}

			.btn::before {
				content: "";
				position: absolute;
				top: 0;
				left: -100%;
				width: 100%;
				height: 100%;
				background: linear-gradient(
					90deg,
					transparent,
					rgba(255, 255, 255, 0.2),
					transparent
				);
				transition: left 0.5s;
			}

			.btn:hover::before {
				left: 100%;
			}

			.btn:hover {
				transform: translateY(-3px);
				box-shadow: 0 15px 35px rgba(165, 180, 252, 0.5);
			}

			.btn:active {
				transform: translateY(-1px);
				box-shadow: 0 8px 20px rgba(165, 180, 252, 0.4);
			}

			.btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
				transform: none;
				box-shadow: 0 5px 15px rgba(165, 180, 252, 0.3);
			}

			.btn:disabled:hover {
				transform: none;
				box-shadow: 0 5px 15px rgba(165, 180, 252, 0.3);
			}

			.btn:disabled::before {
				display: none;
			}

			.results-section {
				margin-top: 40px;
				padding: 30px;
				border-radius: 20px;
				background: linear-gradient(145deg, #fefefe, #fcfcfd);
				border: 1px solid #f1f3f4;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
			}

			.results-section h3 {
				color: #374151;
				margin-bottom: 25px;
				font-size: 1.5em;
				font-weight: 600;
			}

			.vulnerability-card {
				background: #ffffff;
				border-left: 4px solid #dc3545;
				margin: 15px 0;
				padding: 20px;
				border-radius: 12px;
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
				transition: transform 0.3s ease;
			}

			.vulnerability-card:hover {
				transform: translateX(5px);
			}

			.vulnerability-card.high {
				border-left-color: #dc3545;
			}
			.vulnerability-card.medium {
				border-left-color: #ffc107;
			}
			.vulnerability-card.low {
				border-left-color: #28a745;
			}

			.severity-badge {
				padding: 6px 12px;
				border-radius: 6px;
				color: white;
				font-size: 12px;
				font-weight: 600;
				text-transform: uppercase;
			}

			.severity-high {
				background: linear-gradient(135deg, #dc3545, #c82333);
			}
			.severity-medium {
				background: linear-gradient(135deg, #ffc107, #e0a800);
			}
			.severity-low {
				background: linear-gradient(135deg, #28a745, #1e7e34);
			}

			.loading {
				text-align: center;
				padding: 40px 20px;
			}

			.loading-spinner {
				border: 4px solid #f3f4f6;
				border-top: 4px solid #a5b4fc;
				border-radius: 50%;
				width: 50px;
				height: 50px;
				animation: spin 1s linear infinite;
				margin: 0 auto 20px;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			.summary-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 20px;
				margin-bottom: 30px;
			}

			.summary-card {
				padding: 25px;
				border-radius: 15px;
				color: white;
				text-align: center;
				position: relative;
				overflow: hidden;
			}

			.summary-card::before {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: rgba(255, 255, 255, 0.1);
				transform: translateX(-100%);
				transition: transform 0.3s ease;
			}

			.summary-card:hover::before {
				transform: translateX(0);
			}

			.summary-card h3 {
				font-size: 2.5em;
				font-weight: 700;
				margin-bottom: 10px;
			}

			.summary-card p {
				font-size: 1.1em;
				font-weight: 500;
			}

			.high-severity {
				background: linear-gradient(135deg, #dc3545, #c82333);
			}
			.medium-severity {
				background: linear-gradient(135deg, #ffc107, #e0a800);
			}
			.low-severity {
				background: linear-gradient(135deg, #28a745, #1e7e34);
			}
			.total-issues {
				background: linear-gradient(135deg, #667eea, #764ba2);
			}

			.no-vulnerabilities {
				text-align: center;
				padding: 60px 20px;
				color: #28a745;
				background: linear-gradient(145deg, #f0fff4, #e6ffed);
				border-radius: 15px;
				border: 2px solid #28a745;
			}

			.no-vulnerabilities h4 {
				font-size: 2em;
				margin-bottom: 15px;
			}

			.no-vulnerabilities p {
				font-size: 1.2em;
			}

			@media (max-width: 1200px) {
				.scan-options {
					grid-template-columns: 1fr 1fr;
				}
			}

			@media (max-width: 768px) {
				.scan-options {
					grid-template-columns: 1fr;
				}

				.header h1 {
					font-size: 2.5em;
				}

				.main-content {
					padding: 30px 20px;
				}

				.option-card {
					padding: 25px;
				}

				.checkbox-group {
					flex-direction: column;
				}
			}

			/* Dark mode support */
			@media (prefers-color-scheme: dark) {
				.main-content {
					background: rgba(31, 41, 55, 0.95);
					color: #f9fafb;
				}

				.option-card {
					background: linear-gradient(145deg, #374151, #4b5563);
				}

				.form-control {
					background: #4b5563;
					border-color: #6b7280;
					color: #f9fafb;
				}

				.form-control:focus {
					border-color: #667eea;
				}
			}
		</style>
	</head>
	<body>
		<div class="background-decoration">
			<div class="floating-shapes">
				<div class="shape"></div>
				<div class="shape"></div>
				<div class="shape"></div>
				<div class="shape"></div>
			</div>
		</div>

		<div class="container">
			<div class="header">
				<h1><i class="fas fa-shield-alt"></i> CodeSec Scanner</h1>
				<p>
					Comprehensive Security Vulnerability Scanner for Your
					Codebase
				</p>
			</div>

			<div class="main-content">
				<div class="scan-options">
					<div class="option-card">
						<h3><i class="fas fa-upload"></i> Upload Files</h3>
						<form id="upload-form" enctype="multipart/form-data">
							<div class="form-group">
								<label for="files"
									><i class="fas fa-file-code"></i> Select
									files or archive (.zip, .tar.gz):</label
								>
								<input
									type="file"
									id="files"
									name="files"
									class="form-control"
									multiple
									accept=".py,.js,.java,.cpp,.c,.zip,.tar.gz,.tar,.php,.rb,.go,.ts,.cs"
								/>
							</div>
							<div class="form-group">
								<label
									><i class="fas fa-cogs"></i> Security
									Scanners:</label
								>
								<div class="checkbox-group">
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="bandit1"
											name="scan_types"
											value="bandit"
											checked
										/>
										<label for="bandit1"
											>Bandit (Python Security)</label
										>
									</div>
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="safety1"
											name="scan_types"
											value="safety"
											checked
										/>
										<label for="safety1"
											>Safety (Dependencies)</label
										>
									</div>
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="semgrep1"
											name="scan_types"
											value="semgrep"
											checked
										/>
										<label for="semgrep1"
											>Semgrep (Multi-language)</label
										>
									</div>
								</div>
							</div>
							<button type="submit" class="btn">
								<i class="fas fa-rocket"></i> Scan Uploaded
								Files
							</button>
						</form>
					</div>

					<div class="option-card">
						<h3><i class="fab fa-github"></i> GitHub Repository</h3>
						<form id="github-form">
							<div class="form-group">
								<label for="github_url"
									><i class="fas fa-link"></i> GitHub
									Repository URL:</label
								>
								<input
									type="url"
									id="github_url"
									name="github_url"
									class="form-control"
									placeholder="https://github.com/username/repository"
								/>
							</div>
							<div class="form-group">
								<label
									><i class="fas fa-cogs"></i> Security
									Scanners:</label
								>
								<div class="checkbox-group">
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="bandit2"
											name="scan_types"
											value="bandit"
											checked
										/>
										<label for="bandit2"
											>Bandit (Python Security)</label
										>
									</div>
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="safety2"
											name="scan_types"
											value="safety"
											checked
										/>
										<label for="safety2"
											>Safety (Dependencies)</label
										>
									</div>
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="semgrep2"
											name="scan_types"
											value="semgrep"
											checked
										/>
										<label for="semgrep2"
											>Semgrep (Multi-language)</label
										>
									</div>
								</div>
							</div>
							<button type="submit" class="btn">
								<i class="fas fa-search"></i> Scan GitHub
								Repository
							</button>
						</form>
					</div>

					<div class="option-card">
						<h3><i class="fas fa-code"></i> Paste Code</h3>
						<form id="code-form">
							<div class="form-group">
								<label for="language"
									><i class="fas fa-laptop-code"></i>
									Programming Language:</label
								>
								<select
									id="language"
									name="language"
									class="form-control"
								>
									<option value="python">
										üêç Python (.py)
									</option>
									<option value="javascript">
										üìú JavaScript (.js)
									</option>
									<option value="java">
										‚òï Java (.java)
									</option>
									<option value="cpp">‚ö° C++ (.cpp)</option>
									<option value="c">üîß C (.c)</option>
									<option value="php">üêò PHP (.php)</option>
									<option value="ruby">üíé Ruby (.rb)</option>
									<option value="go">üêπ Go (.go)</option>
									<option value="typescript">
										üìò TypeScript (.ts)
									</option>
									<option value="csharp">üî∑ C# (.cs)</option>
								</select>
							</div>
							<div class="form-group">
								<label for="code_content"
									><i class="fas fa-file-code"></i> Code
									Content:</label
								>
								<textarea
									id="code_content"
									name="code_content"
									class="form-control"
									rows="10"
									placeholder="Paste your code here for security analysis..."
								></textarea>
							</div>
							<div class="form-group">
								<label
									><i class="fas fa-cogs"></i> Security
									Scanners:</label
								>
								<div class="checkbox-group">
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="bandit3"
											name="scan_types"
											value="bandit"
											checked
										/>
										<label for="bandit3"
											>Bandit (Python Security)</label
										>
									</div>
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="safety3"
											name="scan_types"
											value="safety"
										/>
										<label for="safety3"
											>Safety (Dependencies)</label
										>
									</div>
									<div class="checkbox-item">
										<input
											type="checkbox"
											id="semgrep3"
											name="scan_types"
											value="semgrep"
											checked
										/>
										<label for="semgrep3"
											>Semgrep (Multi-language)</label
										>
									</div>
								</div>
							</div>
							<button type="submit" class="btn">
								<i class="fas fa-search"></i> Scan Code
							</button>
						</form>
					</div>
				</div>

				<div
					id="results-section"
					class="results-section"
					style="display: none"
				>
					<h3><i class="fas fa-chart-line"></i> Scan Results</h3>
					<div id="results-content"></div>
				</div>
			</div>
		</div>

		<script>
			let currentScanId = null;

			// Handle file upload form
			document
				.getElementById("upload-form")
				.addEventListener("submit", async (e) => {
					e.preventDefault();
					const formData = new FormData(e.target);
					const scanTypes = Array.from(
						e.target.querySelectorAll(
							'input[name="scan_types"]:checked'
						)
					).map((cb) => cb.value);

					if (scanTypes.length === 0) {
						alert("Please select at least one scanner");
						return;
					}

					scanTypes.forEach((type) =>
						formData.append("scan_types", type)
					);

					try {
						showLoading("Uploading files and starting scan...");
						const response = await fetch("/scan/upload", {
							method: "POST",
							body: formData,
						});

						if (response.ok) {
							const result = await response.json();
							currentScanId = result.scan_id;
							pollScanStatus(result.scan_id);
						} else {
							throw new Error("Upload failed");
						}
					} catch (error) {
						showError("Error uploading files: " + error.message);
					}
				});

			// Handle GitHub form
			document
				.getElementById("github-form")
				.addEventListener("submit", async (e) => {
					e.preventDefault();
					const formData = new FormData(e.target);
					const scanTypes = Array.from(
						e.target.querySelectorAll(
							'input[name="scan_types"]:checked'
						)
					).map((cb) => cb.value);

					if (scanTypes.length === 0) {
						alert("Please select at least one scanner");
						return;
					}

					const data = {
						github_url: formData.get("github_url"),
						scan_types: scanTypes,
					};

					try {
						showLoading("Cloning repository and starting scan...");
						const response = await fetch("/scan/github", {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(data),
						});

						if (response.ok) {
							const result = await response.json();
							currentScanId = result.scan_id;
							pollScanStatus(result.scan_id);
						} else {
							throw new Error("Scan failed");
						}
					} catch (error) {
						showError(
							"Error scanning repository: " + error.message
						);
					}
				});

			// Handle code form
			document
				.getElementById("code-form")
				.addEventListener("submit", async (e) => {
					e.preventDefault();
					const formData = new FormData(e.target);
					const scanTypes = Array.from(
						e.target.querySelectorAll(
							'input[name="scan_types"]:checked'
						)
					).map((cb) => cb.value);
					const codeContent = formData.get("code_content");
					const language = formData.get("language");

					if (scanTypes.length === 0) {
						alert("Please select at least one scanner");
						return;
					}

					if (!codeContent || codeContent.trim() === "") {
						alert("Please enter some code to scan");
						return;
					}

					const data = {
						code_content: codeContent,
						language: language,
						scan_types: scanTypes,
					};

					try {
						showLoading("Processing code and starting scan...");
						const response = await fetch("/scan/code", {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(data),
						});

						if (response.ok) {
							const result = await response.json();
							currentScanId = result.scan_id;
							pollScanStatus(result.scan_id);
						} else {
							throw new Error("Scan failed");
						}
					} catch (error) {
						showError("Error scanning code: " + error.message);
					}
				});

			// Handle checkbox item clicks
			document.addEventListener("DOMContentLoaded", function () {
				// Make checkbox items clickable
				document.querySelectorAll(".checkbox-item").forEach((item) => {
					item.addEventListener("click", function (e) {
						// Don't trigger if clicking directly on checkbox or label
						if (
							e.target.type === "checkbox" ||
							e.target.tagName === "LABEL"
						) {
							return;
						}

						const checkbox = item.querySelector(
							'input[type="checkbox"]'
						);
						if (checkbox && !checkbox.disabled) {
							checkbox.checked = !checkbox.checked;
							// Trigger change event
							checkbox.dispatchEvent(
								new Event("change", { bubbles: true })
							);
						}
					});
				});
			});

			// Handle language selection for code scanner
			document
				.getElementById("language")
				.addEventListener("change", function (e) {
					const language = e.target.value;
					const banditCheckbox = document.getElementById("bandit3");
					const safetyCheckbox = document.getElementById("safety3");
					const semgrepCheckbox = document.getElementById("semgrep3");

					// Enable/disable scanners based on language
					if (language === "python") {
						banditCheckbox.disabled = false;
						safetyCheckbox.disabled = false;
						banditCheckbox.checked = true;
						safetyCheckbox.checked = false; // Safety only works with dependencies
					} else {
						banditCheckbox.disabled = true;
						safetyCheckbox.disabled = true;
						banditCheckbox.checked = false;
						safetyCheckbox.checked = false;
					}

					// Semgrep works with most languages
					semgrepCheckbox.disabled = false;
					semgrepCheckbox.checked = true;
				});

			function showLoading(message) {
				const resultsSection =
					document.getElementById("results-section");
				const resultsContent =
					document.getElementById("results-content");
				resultsSection.style.display = "block";
				resultsContent.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p style="font-size: 1.1em; color: #6366f1; font-weight: 500;">${message}</p>
                </div>
            `;
			}

			function showError(message) {
				const resultsSection =
					document.getElementById("results-section");
				const resultsContent =
					document.getElementById("results-content");
				resultsSection.style.display = "block";
				resultsContent.innerHTML = `
                <div style="color: #dc3545; text-align: center; padding: 40px; background: linear-gradient(145deg, #fee2e2, #fecaca); border-radius: 15px; border: 2px solid #dc3545;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px;"></i>
                    <h4 style="margin-bottom: 15px;">Error</h4>
                    <p style="font-size: 1.1em;">${message}</p>
                </div>
            `;
			}

			async function pollScanStatus(scanId) {
				try {
					const response = await fetch(`/scan/${scanId}/status`);
					const status = await response.json();

					if (status.status === "completed") {
						displayResults(scanId);
					} else if (status.status === "failed") {
						showError(
							"Scan failed: " + (status.errors || []).join(", ")
						);
					} else {
						// Continue polling
						const statusMessage = getStatusMessage(status.status);
						showLoading(statusMessage);
						setTimeout(() => pollScanStatus(scanId), 2000);
					}
				} catch (error) {
					showError("Error checking scan status: " + error.message);
				}
			}

			function getStatusMessage(status) {
				const messages = {
					pending: "Scan queued...",
					running: "Scanning in progress...",
					running_bandit: "Running Bandit security scan...",
					running_safety: "Checking dependencies with Safety...",
					running_semgrep: "Running Semgrep analysis...",
				};
				return messages[status] || "Processing...";
			}

			async function displayResults(scanId) {
				try {
					const response = await fetch(`/scan/${scanId}/results`);
					const results = await response.json();

					const resultsContent =
						document.getElementById("results-content");
					resultsContent.innerHTML = generateResultsHTML(results);
				} catch (error) {
					showError("Error loading results: " + error.message);
				}
			}

			function generateResultsHTML(results) {
				const summary = results.summary || {};
				const vulnerabilities = results.vulnerabilities || [];

				let html = `
                <div class="summary-grid">
                    <div class="summary-card high-severity">
                        <h3>${summary.high_severity || 0}</h3>
                        <p><i class="fas fa-exclamation-triangle"></i> High Severity</p>
                    </div>
                    <div class="summary-card medium-severity">
                        <h3>${summary.medium_severity || 0}</h3>
                        <p><i class="fas fa-exclamation-circle"></i> Medium Severity</p>
                    </div>
                    <div class="summary-card low-severity">
                        <h3>${summary.low_severity || 0}</h3>
                        <p><i class="fas fa-info-circle"></i> Low Severity</p>
                    </div>
                    <div class="summary-card total-issues">
                        <h3>${summary.total_vulnerabilities || 0}</h3>
                        <p><i class="fas fa-bug"></i> Total Issues</p>
                    </div>
                </div>
            `;

				if (vulnerabilities.length > 0) {
					html +=
						'<h4 style="margin-bottom: 20px; color: #374151;"><i class="fas fa-list"></i> Vulnerability Details</h4>';
					vulnerabilities.forEach((vuln) => {
						const severityClass = vuln.severity
							? vuln.severity.toLowerCase()
							: "low";
						html += `
                        <div class="vulnerability-card ${severityClass}">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div>
                                    <span class="severity-badge severity-${severityClass}">${
							vuln.severity || "Unknown"
						}</span>
                                    <span style="margin-left: 10px; font-weight: 600; color: #6b7280;">[${
										vuln.tool
									}]</span>
                                </div>
                            </div>
                            <h5 style="margin-bottom: 10px; color: #374151;">${
								vuln.description
							}</h5>
                            <p style="margin-bottom: 8px; background: #1f2937; color: #f9fafb; padding: 8px 12px; border-radius: 6px; font-family: 'JetBrains Mono', monospace; font-size: 14px;"><strong><i class="fas fa-file" style="color: #60a5fa;"></i> File:</strong> <span style="color: #fbbf24;">${
								vuln.file_path
							}</span></p>
                            ${
								vuln.line_number
									? `<p style="margin-bottom: 8px; background: #1f2937; color: #f9fafb; padding: 8px 12px; border-radius: 6px; font-family: 'JetBrains Mono', monospace; font-size: 14px;"><strong><i class="fas fa-hashtag" style="color: #60a5fa;"></i> Line:</strong> <span style="color: #34d399; font-weight: bold;">${vuln.line_number}</span></p>`
									: ""
							}
                            ${
								vuln.code_snippet
									? `<pre style="background: #111827; color: #f9fafb; padding: 15px; border-radius: 8px; margin: 15px 0; overflow-x: auto; border-left: 4px solid #f59e0b; font-size: 14px; font-family: 'JetBrains Mono', monospace; border: 1px solid #374151;"><code style="color: #e5e7eb;">${vuln.code_snippet}</code></pre>`
									: ""
							}
                            ${
								vuln.recommendation
									? `<p style="margin-top: 10px;"><strong><i class="fas fa-lightbulb"></i> Recommendation:</strong> ${vuln.recommendation}</p>`
									: ""
							}
                        </div>
                    `;
					});
				} else {
					html += `
                    <div class="no-vulnerabilities">
                        <h4><i class="fas fa-check-circle"></i> No vulnerabilities found!</h4>
                        <p>Your code looks secure.</p>
                    </div>
                `;
				}

				return html;
			}

			// Initialize the page
			document.addEventListener("DOMContentLoaded", function () {
				// Ensure all form controls are clickable
				document
					.querySelectorAll(".form-control")
					.forEach((control) => {
						control.style.pointerEvents = "auto";
						control.style.zIndex = "10";
					});

				// Ensure file inputs are properly styled and clickable
				document
					.querySelectorAll('input[type="file"]')
					.forEach((fileInput) => {
						fileInput.addEventListener("click", function (e) {
							e.stopPropagation();
						});
					});

				// Ensure select dropdowns are clickable
				document.querySelectorAll("select").forEach((select) => {
					select.addEventListener("click", function (e) {
						e.stopPropagation();
					});
				});

				// Trigger language change event to set initial state
				document
					.getElementById("language")
					.dispatchEvent(new Event("change"));
			});
		</script>
	</body>
</html>
